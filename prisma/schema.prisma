// datasource and generator setup
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  STUDENT
  ADMIN
}



enum EnrollStatus {
   SUCCESS
  PENDING
}

model User {
  id String @id @default(cuid())

  firstName String
  lastName  String
  email     String  @unique
  password  String
  profile   String?

  role UserRole @default(STUDENT)

  otp          String?
  otpExpiresAt DateTime?
  isVerified   Boolean   @default(false)

  accessToken  String?
  refreshToken String?

  testimonials Testimonial?

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  courseReviews CourseReview[]
  courseEnrolls CourseEnroll[]

  // user step progress
  userStepProgress      UserStepProgress?
  userChapterProgress   UserChapterProgress?
  stepEightQuizAttempts StepEightQuizAttempt[]

  @@map("users")
}

model Testimonial {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  courseId  String
  rating    Int     @default(1)
  message   String
  isdisplay Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("testimonials")
}

model Contact {
  id String @id @default(cuid())

  name    String
  phone   String
  email   String
  message String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("contacts")
}

model Blog {
  id String @id @default(cuid())

  title       String
  excerpt     String
  description String
  image       String
  category    String
  isDeleted   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("blogs")
}

model Class {
  id String @id @default(cuid())

  className        String
  classDescription String
  isDeleted        Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subjects Subject[]

  @@map("classes")
}

model Subject {
  id      String @id @default(cuid())
  classId String
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)

  subjectName        String
  subjectDescription String
  banner             String
  isVisible          Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chapters      Chapter[]
  courseEnrolls CourseEnroll[]

  @@map("subjects")
}

model Chapter {
  id String @id @default(cuid())

  sLNumber String // 1

  subjectId String
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  chapterName        String
  chapterDescription String
  thumbnail          String
  isDeleted          Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  podcasts      Podcast[]
  courseReviews CourseReview[]

  // all steps
  stepOne   StepOne?
  stepTwo   StepTwo?
  stepThree StepThree?
  stepFour  StepFour?
  stepFive  StepFive?
  stepSix   StepSix?
  stepSeven StepSeven?
  stepEight StepEight[]
  stepNine  StepNine?

  // student
  userStepProgress    UserStepProgress?
  userChapterProgress UserChapterProgress?

  @@unique([subjectId, sLNumber]) // Ensure unique chapter per subject based on sLNumber
  @@map("chapters")
}

model StepOne {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName        String
  stepDescription String?
  stepVideo       String

  type StepType @default(STEP_ONE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepOne")
}

model StepTwo {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  podcastName  String
  podcastVideo String[]

  type StepType @default(STEP_TWO)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepTwo")
}

model StepThree {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName        String
  stepDescription String
  stepVideo       String

  type StepType @default(STEP_THREE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepThree")
}

model StepFour {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName        String
  stepDescription String
  stepVideo       String

  type StepType @default(STEP_FOUR)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepFour")
}

model StepFive {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName       String
  stepVideo      String
  questionAnswer Json

  type StepType @default(STEP_FIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepFive")
}

model StepSix {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName        String
  stepDescription String
  stepVideo       String

  type StepType @default(STEP_SIX)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepSix")
}

model StepSeven {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName        String
  stepDescription String
  stepVideo       String

  type StepType @default(STEP_SEVEN)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepSeven")
}

model StepEight {
  id String @id @default(cuid())

  chapterId String
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  questionType        String
  questionDescription String
  isDisable           Boolean @default(false)

  type StepType @default(STEP_EIGHT)

  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  stepEightQuizzes StepEightQuiz[]

  @@map("stepEight")
}

model StepEightQuiz {
  id          String    @id @default(cuid())
  stepEightId String
  stepEight   StepEight @relation(fields: [stepEightId], references: [id], onDelete: Cascade)

  questionText  String
  optionA       String
  optionB       String
  optionC       String
  optionD       String
  correctAnswer String

  stepEightQuizAttempts StepEightQuizAttempt[]

  @@unique([stepEightId, questionText])
  @@map("stepEightQuiz")
}

model StepEightQuizAttempt {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  quizId        String
  stepEightQuiz StepEightQuiz @relation(fields: [quizId], references: [id], onDelete: Cascade)

  selectedOption String
  isCorrect      Boolean

  createdAt DateTime @default(now())

  @@unique([userId, quizId])
  @@map("stepEightQuizAttempt")
}

model StepNine {
  id String @id @default(cuid())

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  stepName        String
  stepDescription String
  stepVideo       String

  type StepType @default(STEP_NINE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stepNine")
}

// course Enrollment 

model CourseEnroll {
  id String @id @default(cuid())

  subjectId String
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name         String
  phoneNumber  String
  otp          String?
  otpExpiresAt DateTime?
  enrollStatus EnrollStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([subjectId, userId])
  @@map("courseEnroll")
}

model Podcast {
  id        String @id @default(cuid())
  chapterId String

  podcastName    String
  podcastContent String

  chapter Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("podcasts")
}

model CourseReview {
  id String @id @default(cuid())

  chapterId String
  userId    String
  rating    Int    @default(1)
  message   String

  chapter Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("courseReviews")
}

enum StepType {
  STEP_ONE
  STEP_TWO
  STEP_THREE
  STEP_FOUR
  STEP_FIVE
  STEP_SIX
  STEP_SEVEN
  STEP_EIGHT
  STEP_NINE
}

model UserChapterProgress {
  id String @id @default(cuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  chapterId String  @unique
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  isCompleted Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("userChapterProgress")
}

model UserStepProgress {
  id String @id @default(cuid())

  userId    String @unique
  chapterId String @unique

  stepId      String   @unique // ex: stepOneId
  stepType    StepType @unique // ex: STEP_ONE
  isCompleted Boolean  @default(false)

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  chapter Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("userStepProgress")
}
